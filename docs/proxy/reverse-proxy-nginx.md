---
title: 反向代理服务器的安装配置
editLink: true
description: 反向代理服务器的安装配置文档
layout: doc
head:
    - - meta
      - name: keywords
        content: Nginx, Proxy
outline: deep
prev:
  text:
  link:
next:
  text:
  link:
---

# 反向代理服务器的安装配置（Nginx）

> [!IMPORTANT] 特别注意：
> 如果有 LoadBalance 硬件的情况下，这里的所有配置可以在 LoadBalance 硬件上进行配置，所以这里的所有配置默认为上游没有 LoadBalance 硬件的情况下进行的安装配置。
> 
> 在上游的硬件支持的情况不完全的情况下，可以配置成三层的反向代理，并根据需要选择性的配置接下来的部分内容。

反向代理服务器位于应用服务器的上游，主要将内部服务进行代理从而不暴露真实的业务端口并根据域名和路由来处理外部流量，这里使用 Nginx 作为反向代理服务器，其具体负责处理的内容如下所示：

- SSL 证书卸载
- 金丝雀发布
- 负载均衡
- 访问控制
- 动静分离

并且，通过与 Lua 和 Redis 结合，可以实现更多更强大的功能： <Badge type="tip" text="持续更新" />

- 动态黑名单
- 高性能缓存

对于 Nginx 作为端口转发等正向代理服务器用途，会在后续知识库中具体描述，这里不做过多描述。 并且除了 Nginx 以外，还可以使用 HAproxy 作为反向代理服务器，也会在后续知识库中具体描述。

> [!TIP]
> [OpenResty](https://openresty.org/cn/) 集成了 Nginx 和大量的 Lua 模块，如果不想使用第三方软件，可以使用官方 Nginx 并根据需要自行添加所需的 Lua 模块

还有一些其他的具体应用配置如下：

- 连接数限制
- 防盗链配置
- 跨域配置
- 文件上传限制
  - 限制上传文件大小
  - 限制上传文件权限
- 防止 SQL 注入
- 防止目录遍历

同时，对于生产环境和测试环境还有部分不一样，具体部分如下：

- 缓存时间配置
- 高可用配置

## Nginx 的安装与配置

### Nginx 的安装

由于两台代理服务器是作为高可用使用的，逻辑意义上相当于一台服务器，故安装和配置是完全一样的，这里只描述其中一台的操作，对于两台之间的不同之处会重点指出，除此之外，没有任何的不同操作。


在每一台服务器上配置完成后，需要进行高可用配置，当然，对于只有一台代理服务器的情况下，配置高可用是没有任何意义的。

### Nginx 的配置

Nginx 安装完成之后，还需要修改默认的配置，使其符合业务的需要，主要的配置方面有：

- [ ] SSL 证书卸载
- [ ] 反向代理至业务服务器

## 配置高可用

这里 Nginx 作用是作为反向代理服务器使用，且由于上流**没有 LoadBalance 硬件**进行分流和高可用的配置，这时需要使用软件来配置高可用，常用的方式有两种：

- 基于 Keepalived 的高可用
- 基于 Heartbeat 的高可用

两者的区别如下：

- Keepalived 使用更简单，但是 Heartbeat 功能更强大
- 使用协议不同，Keepalived 使用 VRRP 协议，而 Heartbeat 使用心跳进行通信和选举。

根据具体情况使用其中的一种高可用方式即可。

### 基于 Keepalived 的高可用

### 基于 Heartbeat 的高可用