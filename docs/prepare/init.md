---
title: 服务器初始化
editLink: true
description: 服务器的初始化文档
layout: doc
head:
    - - meta
      - name: keywords
        content: Linux
outline: deep
prev:
    text: 服务器的创建与配置
    link: posts/3edbef81
next:
    text: 业务网络架构
    link: posts/0315077c
---

# 服务器初始化

当操作系统安装完成后，需要对服务器进行初始化操作，以适应生产业务的需要，主要需要的操作内容如下：

- 软件安装
- 安全加固
- 性能调优
- 其他部分

所有需要配置的清单列表如下：

- [x] 服务器架构检查 <Badge type="warning" text="需要留意" />
  - [x] ARM 64 或 AMD 64
- [x] 各服务器之间的横向 SSH 是否联通 <Badge type="danger" text="后续影响" />
- [ ] 服务器密码强弱性检查 <Badge type="danger" text="特别注意" />
  - [x] 弱密码
  - [ ] 禁止 root 用户远程登录
- [ ] 防火墙开放状态
- [ ] 物理磁盘部分
  - [ ] 虚拟机是否挂载数据盘
  - [ ] 测试磁盘是否为 SSD <Badge type="danger" text="后续影响" />
  - [ ] 配置 LVM
- [ ] SELinux 配置
- [ ] 修改镜像源
- [ ] 升级 OpenSSL
- [ ] 升级 OpenSSH
  - [ ] 9.8p1 版本以上 
  - [ ] 禁用特定算法，修复 [CVE-2002-20001](a7fc9217) 漏洞
- [ ] 配置文件最大打开数
- [ ] 调整内核参数

## 前置检查

### 服务器架构检查

检查服务器的系统架构，确保在安装业务所需软件时下载正确的架构版本安装包，使用如下命令进行查看：

```bash
uname -m
```

常见的为 64 位版本，输出结果一般为：`x86_64`，对于不同的输出，可以自行上网查看为何种架构，并在后续安装软件时下载对应的架构版本安装包即可，为了文档编写的方便，这里默认所有的服务器系统架构都为 64 位版本。

### 横向 SSH 通信检查

主要检查的是 Jenkins 或其他 CI&CD 软件所在的服务器能否通过 SSH 协议访问至应用服务器，主要影响在于后续配置流水线发布时需要通过 SSH 协议进行代码包分发，如果无法通信，后续流水线可能无法搭建。<Badge type="warning" text="寻找他法" />

检查方法很简单，在 Jenkins 所在服务器上使用 SSH 协议登录其他服务器，如果可以成功登录即证明通信正常，注意为了安全，可以端口号不是默认的 22 端口：

```bash
# 192.168.50.11 为应用服务器中的其中一台的局域网 IP 地址
# 22022 是为了安全而修改后的 SSH 协议占用的端口，如果不显式指定，则为默认的 22 端口
ssh nginx@192.168.50.11 -p 22022
```

如果成功，会要求输入密码进行验证登录，如果返回其他结果，请视具体情况而定。

这里以一台为例，对于其他的应用服务器，只需要修改相应的 IP 地址即可，这里不在做演示。

### 服务器密码强弱性检查

服务器的密码不能是常见的弱密码，最好为 16 位以上包含如下内容的乱序字符串：

- 大小写字母
- 数字
- 特殊标点

特别注意，不要使用容易混肴的字母和数字，例如：

- 0、o、O
- I、l、1

如果密码不符合要求，可以使用如下命令来修改特定用户的密码。

> [!IMPORTANT]
> 注意使用 root 用户进行该操作

```bash
# 修改 nginx 用户密码
passwd nginx

# 修改 root 用户密码
passwd
```

出于安全性的进一步考虑，还需要配置禁止 root 用户的远程登录：

修改 `/etc/ssh/sshd_config` 文件，修改如下内容即可：

```
# 取消如下注释内容并修改 [!code --]
#PermitRootLogin yes [!code ++]
PermitRootLogin no   
```

## 软件安装

软件安装的主要是为了方便后续的运维操作，以及确保编译安装业务软件所需求的依赖存在等。

### 安装常用软件

对于常用地依赖软件，使用 `yum` 来进行安装，主要安装的内容如下：

```bash
yum install -y vim lrzsz
```

## 安全加固

安全加固的主要目的是为了保证服务器的安全性，具体的操作内容有以下几点：

- 升级低版本软件
- 修复系统漏洞

## 性能优化

性能优化的主要目的是为了让服务器性能得到最大释放，保证服务不会因为服务器的配置存在性能瓶颈，具体的操作内容有以下几点：

- 最大文件打开数修改
- 内核配置调整

## 其他部分

> [!NOTE]
> 该部分内容主要针对特定服务器的特定需求，对于不同业务而言，根据需要选择性的执行以下内容中的相关设置。